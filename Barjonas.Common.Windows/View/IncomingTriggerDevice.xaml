<ResourceDictionary x:Class="Barjonas.Common.View.IncomingTriggerDevice"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
             xmlns:conv="clr-namespace:Barjonas.Common.Converters"
             xmlns:commodel="clr-namespace:Barjonas.Common.Model"
             xmlns:iconPacks="http://metro.mahapps.com/winfx/xaml/iconpacks"
             xmlns:controls="clr-namespace:MahApps.Metro.Controls;assembly=MahApps.Metro"
             mc:Ignorable="d" >
    <Canvas x:Key="SwitchClosed">
        <Path Data="M55.055004,38.023997 C53.221004,38.023997 51.729004,39.446998 51.583004,41.243999 51.583004,41.254001 51.586002,41.263999 51.586002,41.272998 51.586002,41.369998 51.568005,41.460998 51.558002,41.554 51.574005,43.47 53.135002,45.023997 55.055004,45.023997 56.984005,45.023997 58.555004,43.453998 58.555004,41.523997 58.555004,39.594001 56.984005,38.023997 55.055004,38.023997 z M119.25301,38.022998 C117.32301,38.022998 115.75301,39.592998 115.75301,41.522998 115.75301,43.452998 117.32301,45.022998 119.25301,45.022998 121.18301,45.022998 122.75301,43.452998 122.75301,41.522998 122.75301,39.592998 121.18301,38.022998 119.25301,38.022998 z M91.214005,14.700998 L63.722004,37.728999 116.07101,30.405997 z M91.007011,9.1129981 C91.469009,9.113 91.933006,9.2410002 92.34201,9.4999991 L123.73601,29.334003 146.01402,26.216998 C146.132,26.200999 146.248,26.193002 146.36302,26.193004 147.591,26.193002 148.66101,27.096999 148.83601,28.346997 149.02699,29.714002 148.07402,30.978002 146.707,31.169004 L119.107,35.029998 C119.15601,35.028998 119.204,35.022998 119.25301,35.022998 121.95701,35.022998 124.27801,36.683997 125.257,39.037997 125.30501,39.034999 125.35001,39.022998 125.398,39.022998 L178.95799,39.022998 C180.339,39.022998 181.45799,40.143001 181.45799,41.522998 181.45799,42.903998 180.339,44.022998 178.95799,44.022998 L125.398,44.022998 C125.35001,44.022998 125.30401,44.012 125.257,44.008998 124.27801,46.362998 121.95701,48.022998 119.25301,48.022998 115.66901,48.022998 112.75301,45.106998 112.75301,41.522998 112.75301,38.501998 114.828,35.963 117.62501,35.237998 L61.351006,43.11 C60.641003,45.929 58.091003,48.023997 55.055004,48.023997 52.262005,48.023997 49.882004,46.250999 48.964005,43.772998 L3.1690009,43.772998 C1.7880006,43.772998 0.66900063,42.653998 0.66899943,41.272998 0.66900063,39.893001 1.7880006,38.772998 3.1690009,38.772998 L49.086002,38.772998 C49.115005,38.772998 49.142002,38.780997 49.170002,38.782001 50.207005,36.566001 52.451004,35.023997 55.055004,35.023997 56.193005,35.023997 57.263004,35.319999 58.195004,35.837001 58.196003,35.834998 58.197002,35.833999 58.199005,35.832999 L89.401009,9.6969996 C89.863007,9.3100005 90.434006,9.113 91.007011,9.1129981 z" Fill="Black" Height="38.911" Stretch="Fill" Width="180.789" Canvas.Left="0.669" Canvas.Top="9.113"/>
    </Canvas>
    <Canvas x:Key="SwitchOpen">
        <Path Data="M54.966061,38.001007 C53.132061,38.001007 51.639057,39.424008 51.494057,41.221009 51.494057,41.23201 51.497059,41.241009 51.497059,41.251007 51.497059,41.347008 51.479057,41.438008 51.46806,41.53101 51.485058,43.447006 53.046059,45.002007 54.966061,45.002007 56.895065,45.002007 58.466064,43.431008 58.466064,41.502007 58.466064,39.571007 56.895065,38.001007 54.966061,38.001007 z M119.16394,38.00021 C117.23393,38.00021 115.66393,39.57021 115.66393,41.50021 115.66393,43.430207 117.23393,45.000206 119.16394,45.000206 121.09394,45.000206 122.66394,43.430207 122.66394,41.50021 122.66394,39.57021 121.09394,38.00021 119.16394,38.00021 z M119.16394,35.00021 C121.86794,35.00021 124.18894,36.661209 125.16795,39.015209 125.21594,39.012207 125.26095,39.00021 125.30894,39.00021 L178.869,39.00021 C180.25002,39.00021 181.369,40.120209 181.369,41.50021 181.369,42.881207 180.25002,44.000206 178.869,44.000206 L125.30894,44.000206 C125.26095,44.000206 125.21494,43.989208 125.16795,43.986206 124.18894,46.340206 121.86794,48.000206 119.16394,48.000206 115.57993,48.000206 112.66393,45.08421 112.66393,41.50021 112.66393,37.91621 115.57993,35.00021 119.16394,35.00021 z M84.445099,7.4870126 L62.69907,35.967011 111.58313,17.542012 z M83.580093,2.0010142 C83.871094,2.0010145 84.164093,2.0510144 84.448097,2.1560142 L118.71714,14.852014 140.44817,6.6620142 C140.73816,6.5510137 141.03616,6.5000141 141.33017,6.5000145 142.34016,6.5000141 143.29216,7.1170137 143.66916,8.119015 144.15617,9.4110138 143.50417,10.853013 142.21216,11.340014 L61.568069,41.737007 C61.529072,41.752007 61.49007,41.756008 61.452068,41.768009 61.311069,45.228009 58.460068,48.002007 54.966061,48.002007 52.173058,48.002007 49.793056,46.228009 48.875053,43.751007 L3.0800011,43.751007 C1.6989998,43.751007 0.57999843,42.632008 0.57999873,41.251007 0.57999843,39.870011 1.6989998,38.751007 3.0800011,38.751007 3.0800014,38.751007 48.997055,38.751007 48.997055,38.751007 49.026054,38.751007 49.052055,38.758007 49.081055,38.759011 50.117058,36.54401 52.362061,35.001011 54.966061,35.001011 55.645061,35.001011 56.301064,35.10701 56.918064,35.30101 L81.593094,2.9830153 C82.076096,2.3510144 82.817093,2.0010145 83.580093,2.0010142 z" Fill="Black" Height="46.001" Stretch="Fill" Width="180.789" Canvas.Left="0.58" Canvas.Top="2.001"/>
    </Canvas>
    <conv:ToOneBased x:Key="ToOneBased"/>
    <conv:EnumToDescriptionConverter x:Key="EnumToDescriptionConverter"/>
    <BooleanToVisibilityConverter  x:Key="BooleanToVisibilityConverter"/>
    <conv:IntToOrdinalConverter x:Key="IntToOrdinalConverter"/>
    <DataTemplate x:Key="Trigger">
        <DataTemplate.Resources>
            <Storyboard x:Key="TriggerIndicatorSB" >
                <DoubleAnimation Storyboard.TargetName="TriggerIndicator" Storyboard.TargetProperty="Opacity" From="1" To="0" Duration="0:0:0.5" />
            </Storyboard>
        </DataTemplate.Resources>
        <Grid ToolTip="Double right click to enable/disable" Margin="5">
            <Grid Visibility="{Binding IsDown, Converter={StaticResource BooleanToVisibilityConverter}}">
                <Grid.Background>
                    <RadialGradientBrush>
                        <GradientStop Color="#ff0000ff"/>
                        <GradientStop Color="#ff000055" Offset="1"/>
                    </RadialGradientBrush>
                </Grid.Background>
                <Rectangle Fill="White">
                    <Rectangle.OpacityMask>
                        <VisualBrush Stretch="Uniform" Visual="{DynamicResource SwitchClosed}" />
                    </Rectangle.OpacityMask>
                </Rectangle>
            </Grid>
            <Grid Background="#ff000033" Visibility="{Binding IsDown, Converter={StaticResource MatchToBooleanConverter}, ConverterParameter={conv:Bool False}}">
                <Rectangle Fill="White">
                    <Rectangle.OpacityMask>
                        <VisualBrush Stretch="Uniform" Visual="{DynamicResource SwitchOpen}" />
                    </Rectangle.OpacityMask>
                </Rectangle>
            </Grid>
            <Grid Visibility="{Binding Setting.IsEnabled, Converter={StaticResource MatchToBooleanConverter},ConverterParameter={conv:Bool False}}">
                <iconPacks:PackIconModern Kind="Stop" Width="15" Height="15" HorizontalAlignment="Center" />
            </Grid>
            <Grid>
                <iconPacks:PackIconModern Opacity="0" Kind="Lightning" Name="TriggerIndicator" Width="15" Height="15" VerticalAlignment="Top" HorizontalAlignment="Center" Foreground="Yellow" Tag="{Binding LastTriggerDateTime, NotifyOnTargetUpdated=True}">
                    <iconPacks:PackIconModern.Triggers>
                        <EventTrigger RoutedEvent="Binding.TargetUpdated">
                            <BeginStoryboard Storyboard="{StaticResource TriggerIndicatorSB}" />
                        </EventTrigger>
                    </iconPacks:PackIconModern.Triggers>
                </iconPacks:PackIconModern>
            </Grid>
            <Grid.InputBindings>
                <MouseBinding MouseAction="RightDoubleClick" Command="{Binding ToggleIsEnabledCommand}" />
            </Grid.InputBindings>
        </Grid>
    </DataTemplate>
    <DataTemplate DataType="{x:Type commodel:IncomingTriggerDevice}" x:Key="IncomingTriggerDevice">
        <StackPanel Background="{StaticResource ControlGroupBackground}" Margin="{StaticResource ControlSmallMargin}">
            <StackPanel Orientation="Horizontal" Margin="{StaticResource ControlSmallMargin}">
                <ContentControl Content="{Binding}" ContentTemplate="{StaticResource ServiceStatus}" VerticalAlignment="Center" />
                <TextBlock Style="{StaticResource Heading}" Text="{Binding Name, Mode=OneWay}" VerticalAlignment="Center" Margin="{StaticResource ControlSmallMargin}"/>
                <ItemsControl ItemsSource="{Binding ServiceState.Children.Values}" ItemTemplate="{StaticResource ServiceStateMax}" VerticalAlignment="Center" />
                <ContentControl Content="{Binding}" />
            </StackPanel>
            <DataGrid ItemsSource="{Binding Triggers}" AutoGenerateColumns="False">
                <DataGrid.Resources>
                    <Style TargetType="Button" BasedOn="{StaticResource MahApps.Styles.Button.Flat}">
                        <Setter Property="Height" Value="20"/>
                        <Setter Property="Margin" Value="1 0"/>
                        <Setter Property="Padding" Value="0"/>
                    </Style>
                </DataGrid.Resources>
                <DataGrid.Columns>
                    <DataGridTemplateColumn Header="Test">
                        <DataGridTemplateColumn.CellTemplate>
                            <DataTemplate>
                                <UniformGrid Rows="1">
                                    <Button Command="{Binding SimulateTriggerCommand}" Content="M" ToolTip="Momentary"/>
                                    <Button Command="{Binding SimulateTriggerCommand}" Content="L" ToolTip="Latching" CommandParameter="{conv:Bool true}" />
                                </UniformGrid>
                            </DataTemplate>
                        </DataGridTemplateColumn.CellTemplate>
                    </DataGridTemplateColumn>
                    <DataGridTextColumn IsReadOnly="True" Binding="{Binding Setting.Name}" Header="Name" Width="Auto"/>
                    <DataGridTemplateColumn Header="Down">
                        <DataGridTemplateColumn.CellTemplate>
                            <DataTemplate>
                                <ContentControl Content="{Binding}" ContentTemplate="{StaticResource Trigger}" Width="50" Height="20"/>
                            </DataTemplate>
                        </DataGridTemplateColumn.CellTemplate>
                    </DataGridTemplateColumn>
                    <DataGridTemplateColumn Header="ID">
                        <DataGridTemplateColumn.CellTemplate>
                            <DataTemplate>
                                <controls:NumericUpDown Value="{Binding Setting.Id, Converter={StaticResource ToOneBased}, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" Minimum="1" Maximum="256" NumericInputMode="Numbers"/>
                            </DataTemplate>
                        </DataGridTemplateColumn.CellTemplate>
                    </DataGridTemplateColumn>
                    <DataGridTextColumn Header="Time" IsReadOnly="True" Binding="{Binding Time}" MinWidth="102" />
                    <DataGridTextColumn Header="#" IsReadOnly="True" Binding="{Binding Ordinal, Converter={StaticResource IntToOrdinalConverter}}" />
                    <DataGridTextColumn Header="Filter" IsReadOnly="True" Binding="{Binding Setting.TriggerFilter, Converter={StaticResource EnumToDescriptionConverter}}" />
                    <DataGridTemplateColumn Header="Enabled">
                        <DataGridTemplateColumn.CellTemplate>
                            <DataTemplate>
                                <CheckBox IsChecked="{Binding Setting.IsEnabled, UpdateSourceTrigger=PropertyChanged}" HorizontalAlignment="Center" />
                            </DataTemplate>
                        </DataGridTemplateColumn.CellTemplate>
                    </DataGridTemplateColumn>
                </DataGrid.Columns>
            </DataGrid>
        </StackPanel>
    </DataTemplate>
</ResourceDictionary>
